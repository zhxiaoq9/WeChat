
复位最主要的目的是对电路进行初始化，保证电路从一个稳定的工作状态开始工作。复位电路与时钟一样都是一个树形的结构，实际复位电路的设计中，寄存器有可能需要复位，也有可能不需要复位，当需要复位时，设计者需要选择是同步复位还是异步复位。因此复位的设计对系统来说也是非常重要的。

**1.异步复位**  
复位信号有效时系统立即复位，复位与时钟无关。其编码方式如下：
```verilog
module ASYN_RESET(
input         clk,
input         rst_n,
input         in,
output reg    out
);

always @(posedge clk or negedge rst_n)
	if(rst_n == 1'b0)      //与时钟无关
		out <= 1'b0;
    else
		out <= in;

endmodule
```
综合出的电路如下图所示：   
![异步复位](https://raw.githubusercontent.com/zhxiaoq9/WeChat/master/ClassicalCircuitDesign_RESET/images/asyn_reset.PNG "异步复位")     
可见复位信号**rst_n**直接输入到寄存器的异步复位端，并且与时钟无关。

**2.同步复位**  
```verilog
module SYN_RESET(
input         clk,
input         rst_n,
input         in,
output reg    out
);

always @(posedge clk)
	if(rst_n == 1'b0)    //与时钟有关
		out <= 1'b0;
    else
		out <= in;

endmodule

```
综合出的电路如下图所示：   
![同步复位](https://raw.githubusercontent.com/zhxiaoq9/WeChat/master/ClassicalCircuitDesign_RESET/images/syn_reset.PNG "同步复位")    

同步复位时，复位信号**rst_n**并不会直接连接到寄存器异步复位端口，而是与输入信号**in**经过一层组合逻辑(上图是用vivado综合出来的，组合逻辑用LUT实现，如果针对的是ASIC，那么这部分会综合成2选1的多路选择器)后输入到寄存器的D端口。而不像异步复位那样直接输入到寄存器的异步复位端口。所以同步复位的复位信号必须在时钟的上升沿或下降沿才能起作用。


**3.同步复位与异步复位对比**  
同步复位与异步复位各有优缺点，总结如下。

* 同步复位依赖时钟的同步，异步复位不需要。所以在同步系统中一定要保证时钟正常工作，否则无法完成复位。例如系统的上电复位或三态总线的复位。  
* 由于同步复位的复位信号需要与寄存器D端的输入信号做组合逻辑操作，因此消耗了额外的逻辑资源。并且对于不同的寄存器来说，此组合逻辑与寄存器距离不同可能导致复位信号到达寄存器的时延不同，从而造成时序问题。同时在后端布局布线时由于要平衡复位信号到每个寄存器的时延，可能会使复位信号端插入过多的缓冲器从而进一步增加面积。
* 同步复位可以消除小于时钟周期的毛刺复位信号，而异步复位没有抵抗毛刺的功能，需要专门的去毛刺电路。
* 复位网络问题：异步复位是一个类似于时钟树的树形结构，它连接到了很多个寄存器的异步复位端。这就造成难以保证各寄存器在同一时钟周期内退出复位。如下图所示，复位信号**rst_n**撤销后由于到寄存器**reg0**和**reg1**的延时不同导致两个寄存器在不同的时钟周期撤销复位。这种情况必然会影响系统正常运行。   
![撤销复位](https://raw.githubusercontent.com/zhxiaoq9/WeChat/master/ClassicalCircuitDesign_RESET/images/timing.PNG "撤销复位")    
* 复位撤离问题：同步复位可进行静态时序分析来分析建立保持时间，异步复位不能进行静态时序分析。这就导致如果异步复位信号在时钟有效沿附近撤销复位的话可能发生亚稳态，如下图所示。   
![撤销复位发生亚稳态](https://raw.githubusercontent.com/zhxiaoq9/WeChat/master/ClassicalCircuitDesign_RESET/images/metastable.PNG "撤销复位发生亚稳态")   

**可能有人不理解，异步复位信号不是跟时钟没有关系吗，那为什么如果撤销复在时钟有效沿附近可能会发生亚稳态，难道寄存器异步复位端口的信号也是在时钟有效沿采样的？那这不是跟异步复位的说法冲突了吗？**    
>其实这个问题我也思考了很久，现在我觉得真正的原因应该是这样：在撤离复位时，如果寄存器检查这个撤离操作已经完成，那么寄存器应该采样D端的信号输出到Q端；如果寄存器检查这个撤离操作还没有完成，那么寄存器应该继续保持复位状态。问题是，这个撤离操作在时钟有效沿附近，所以在时钟有效沿到来时，寄存器到底有没有撤离复位是不确定的。所以撤销复位时出现的亚稳态完全是因为撤离复位与时钟有效沿距离太近，而不是因为时钟要采样异步复位端口。


大多数IC厂商提供的库以及FPGA中，寄存器常常只有异步复位端口，因此实际工程中使用异步复位的情况会更多一点。